---
title: "R Notebook to get lat/long"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
datafol <- read_csv('./data/exif-aug2020-cleaned.csv')
#datafol %>% write_csv('./data/exif_aug2020-temp.csv')
colsites2020 <- datafol %>% 
#  mutate_each(funs(as.numeric)) %>%
  transmute(lat_dec=gps_latitude_d + gps_latitude_m/60 + gps_latitude_s/60^2,
            long_dec=(gps_longitude_d + gps_longitude_m/60 + gps_longitude_s/60^2) * -1) %>% as.data.frame()
```

```{r}
library(sp)
library(sf)
xy <- cbind(x=colsites2020$long_dec , 
            y=colsites2020$lat_dec)
S <- SpatialPoints(xy)
meadowSites <- bbox(S)
meadowSites
```

```{r}
library(ceramic)

roi <- raster::extent(-121.73088,-121.71093,46.77072 , 46.79736)
#im <- cc_location(roi,buffer = 5000)
im <- cc_location(roi,buffer = 1e11)

#> Preparing to download: 16 tiles at zoom = 4 from 
#> https://api.mapbox.com/v4/mapbox.satellite/

raster::plotRGB(im)

crs<-"+proj=longlat +datum=WGS84"

# Project Raster
projected_raster_ms <- raster::projectRaster(im, crs = crs)

```

```{r}
library(raster)
library(ggplot2)
library(ggthemes)

mydata <- getData("GADM", country = "USA", level = 1)
mymap <- fortify(mydata)

g1 <-  ggplot() +
       geom_blank(data = mymap, aes(x = long, y = lat)) +
       geom_map(data = mymap, map = mymap,
                 aes(group = group, map_id = id),
                 fill = "#b2b2b2", color = "black", size = 0.3) +
 #[-124.733643,45.543831,-116.916161,49.002405] WA state
       scale_x_continuous(limits = c(-124.733643, -116.916161), expand = c(0, 0)) +
       scale_y_continuous(limits = c(45.543831, 49.002405), expand = c(0, 0)) +
       theme_map()

# 'US': ('United States', (-171.791110603, 18.91619, -66.96466, 71.3577635769)),
#Northernmost: 49.382808 Southernmost: 24.521208 Easternmost: -66.945392 Westernmost: -124.736342


gUSA <-  ggplot() +
       geom_blank(data = mymap, aes(x = long, y = lat)) +
       geom_map(data = mymap, map = mymap,
                 aes(group = group, map_id = id),
                 fill = "#b2b2b2", color = "black", size = 0.3) +
 #[-124.733643,45.543831,-116.916161,49.002405] WA state
       scale_x_continuous(limits = c(-124.736342, -66.964661), expand = c(0, 0)) +
       scale_y_continuous(limits = c(24.521208, 49.382808), expand = c(0, 0)) +
       theme_map()

#s1 -121.73113 -121.71071
#s2   46.77049   46.79759
temp <- data.frame(long = c(-121.73113, -121.73113,-121.71071,-121.71071, -121.73113),
                   lat = c(46.77049, 46.79759, 46.79759, 46.77049, 46.77049))

# [
#               -121.9696572753912,
#               47.01151109725859
#             ],
#             [
#               -121.9696572753912,
#               46.708203618730494
#             ],
#             [
#               -121.50960478515694,
#               46.708203618730494
#             ],
#             [
#               -121.50960478515694,
#               47.01151109725859
#             ],
#             [
#               -121.9696572753912,
#               47.01151109725859
#             ]

tempy <- data.frame(long = c(  -121.9696572753912, 
                               -121.9696572753912,
                               -121.50960478515694,
                               -121.50960478515694,
                                -121.9696572753912),
                   lat = c(47.01151109725859,
                            46.708203618730494, 
                           46.708203618730494,
                           47.01151109725859,
                           47.01151109725859))

tempfy <- data.frame(long = c(  -121.9696572753912, 
                               -121.9696572753912,
                               -121.50960478515694,
                               -121.50960478515694,
                                -121.9696572753912),
                   lat = c(47.01151109725859,
                            46.708203618730494, 
                           46.708203618730494,
                           47.01151109725859,
                           47.01151109725859),
                   group= c(1,1,1,1,1))

insetMS <- ggplotGrob(g1 + geom_path(data = tempy, aes(x = long, y = lat), color="blue", size = 2) +  coord_map("polyconic") +
      theme_map() +
      theme(panel.background = element_rect(fill = 'white')))

insetMSUSA <- ggplotGrob(gUSA+ geom_path(data = tempy, aes(x = long, y = lat), color="blue", size = 2) + theme(panel.grid.major = element_line(color = gray(0.5), linetype = "dashed", 
        size = 0.5), panel.background = element_rect(fill = "aliceblue")))

```


```{r}

colsites2020_filter <- colsites2020 %>% filter(long_dec > -121.73)
```

```{r}
library(rasterVis)
library(RStoolbox)
library(tidyverse)
library(ggspatial)

library(mapdata)
counties <- map_data("county")
ca_county <- subset(counties, region == "california")
states <- map_data("state")
wa_df <- subset(states, region == "washington")
  park <- data.frame(
  x = c(-121.9696572753912), 
  y = c( 47.01151109725859), 
  parkp = c("Mt. Rainier National Park")
)
  
p1_map_revised<-ggplot(data = states, mapping = aes(x = long, y = lat, group = group)) + 
    coord_fixed(1.3) + 
    geom_polygon(color = "black", fill = "gray") + theme_void() +geom_polygon(data = wa_df, fill = NA, color = "green")  + geom_polygon(data = tempfy, aes(x = long, y = lat), color="blue", size = 2) 


p1_map_revised 

p3 <- ggplot() + geom_polygon(data = tempy, aes(x = long, y = lat), color="blue", size = 2) + coord_map("polyconic") +
      theme_map() +
      theme(panel.background = element_rect(fill = 'white'))
  
ggRGB(projected_raster_ms, r=1,g=2, b=3)  +  
   geom_spatial_point(data=colsites2020_filter, aes(long_dec,lat_dec,alpha=0.5,color='red')) +
    coord_sf(crs = 4326)   +
theme(panel.background = element_rect(colour = "black", fill="white"),
      axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
ggspatial::annotation_scale(  pad_x = unit(0.5, "mm"),pad_y = unit(0.5, "mm"),location = "bl", width_hint = 0.5)+
     ggspatial::annotation_north_arrow(location = "lr", which_north = "true", 
     pad_x = unit(0.5, "mm"),pad_y = unit(0.5, "mm"),style = ggspatial::north_arrow_fancy_orienteering) +
  labs(x="",y="", color="") +
  scale_color_manual(values = c('red'),labels=c("Sites")) +
  annotation_custom(grob = insetMS, xmin = -121.73113, xmax = -121.7211,
                        ymin = 46.792, ymax = 46.797)
ggsave("figs/meadow_sites.png",dpi=300, dev='png',  height=10, width=8,units="in")
        
```


Revised plot

```{r}
library(rasterVis)
library(RStoolbox)
library(tidyverse)
library(ggspatial)
ggRGB(projected_raster_ms, r=1,g=2, b=3)  +  
   geom_spatial_point(data=colsites2020_filter, aes(long_dec,lat_dec,alpha=0.5,color='red')) +
    coord_sf(crs = 4326, expand = TRUE)   +
theme(panel.background = element_rect(colour = "black", fill="white"),
      axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
 annotation_scale(location = "bl", width_hint = 0.4) +
    annotation_north_arrow(location = "bl", which_north = "true", 
        pad_x = unit(0.1, "in"), pad_y = unit(0.5, "in"),
        style = north_arrow_fancy_orienteering) +
    labs(x="",y="", color="") +
  scale_color_manual(values = c('red'),labels=c("Sites")) 
ggsave("figs/meadow_sites_r1.png",dpi=200, dev='png',  height=6, width=6,units="in")
        
```


Revised plot 3

```{r}
library(rasterVis)
library(RStoolbox)
library(tidyverse)
library(ggspatial)
p1 = ggRGB(projected_raster_ms, r=1,g=2, b=3)  +  
   geom_spatial_point(data=colsites2020_filter, aes(long_dec,lat_dec,alpha=0.5,color='red')) +
    coord_sf(crs = 4326)   +
theme(panel.background = element_rect(colour = "black", fill="white"),
      axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
 annotation_scale(location = "bl", width_hint = 0.4) +
    annotation_north_arrow(location = "bl", which_north = "true", 
        pad_x = unit(0.1, "in"), pad_y = unit(0.5, "in"),
        style = north_arrow_fancy_orienteering) +
    labs(x="",y="", color="") +
  scale_color_manual(values = c('red'),labels=c("Sites")) 

 ggplot() +
 coord_equal(xlim = c(0, 30), ylim = c(0, 30), expand = FALSE) +

  annotation_custom(ggplotGrob(p1), xmin = 0, xmax = 30, ymin = 0, 
                    ymax = 30) +
 #geom_segment(aes(xend = x1, yend = y1, x = x2, y = y2), data = arrowA, 
#               arrow = arrow(), lineend = "round") +
    annotation_custom(ggplotGrob(p1_map_revised), xmin = 5, xmax = 20, ymin = 23, 
                    ymax = 30) +

  theme_void()
ggsave("figs/meadow_sites_r2.png",dpi=300, dev='png',  height=10, width=8,units="in")
        
```
